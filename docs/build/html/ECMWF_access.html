<!DOCTYPE html>

<html lang="en" data-content_root="./">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Setting up ECMWF to run the IMAU Firn Densification Model &#8212; IMAU-FDM 1.2.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=5ecbeea2" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css?v=12dfc556" />
    <script src="_static/documentation_options.js?v=ca842793"></script>
    <script src="_static/doctools.js?v=9bcbadda"></script>
    <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="&lt;no title&gt;" href="preprocessing.html" />
    <link rel="prev" title="File Structure" href="filestructure.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="setting-up-ecmwf-to-run-the-imau-firn-densification-model">
<h1>Setting up ECMWF to run the IMAU Firn Densification Model<a class="headerlink" href="#setting-up-ecmwf-to-run-the-imau-firn-densification-model" title="Link to this heading">¶</a></h1>
<section id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://confluence.ecmwf.int/display/UDOC/Atos+HPCF+and+ECS+Introduction+Tutorial">Training
Manual</a>
<a class="reference external" href="https://hpc-usage.ecmwf.int/sbu-accounting/my-accounts">Monitoring compute
time/resources</a></p>
</section>
<section id="pre-requisites">
<h2>Pre-requisites<a class="headerlink" href="#pre-requisites" title="Link to this heading">¶</a></h2>
<ol class="arabic simple">
<li><p>request access to IMAU ECMWF account</p></li>
<li><p>set up multi-factor authentication (login -&gt; account -&gt; change
password/OTP)</p></li>
</ol>
</section>
<section id="logging-in-for-the-first-time">
<h2>Logging in for the first time<a class="headerlink" href="#logging-in-for-the-first-time" title="Link to this heading">¶</a></h2>
<p><a class="reference external" href="https://www.ecmwf.int/en/computing/access-computing-facilities/how-log">ECMWF how to login
documentation</a></p>
<section id="ssh">
<h3>SSH<a class="headerlink" href="#ssh" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>install teleport &lt;=13 from
<a class="reference external" href="https://goteleport.com/download/">website</a> (do not use brew!
installs version &gt; 13)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">teleport-login</span></code> (might need to add <code class="docutils literal notranslate"><span class="pre">--force-clean</span></code>)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">mkdir</span> <span class="pre">~/.ssh</span></code> and <code class="docutils literal notranslate"><span class="pre">touch</span> <span class="pre">~/.ssh/config</span></code>if don’t already exist</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">open</span> <span class="pre">~/.ssh/config</span></code> and edit ssh config file, replacing
ecmwfusername with your username and <a class="reference external" href="mailto:user&#46;address&#37;&#52;&#48;somewhere&#46;com">user<span>&#46;</span>address<span>&#64;</span>somewhere<span>&#46;</span>com</a> with
your email</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Match host jump.ecmwf.int exec &quot;tsh status --proxy %h &gt;/dev/null 2&gt;&amp;1 || tsh --proxy %h login&quot;
Host jump.ecmwf.int a?-* a??-* hpc-* hpc2020-* ecs-*
  User ecmwfusername
  IdentityFile ~/.tsh/keys/jump.ecmwf.int/user.address@somewhere.com
  CertificateFile ~/.tsh/keys/jump.ecmwf.int/user.address@somewhere.com-ssh/jump.ecmwf.int-cert.pub
  HostKeyAlgorithms +ssh-rsa*,rsa-sha2-512
  PubkeyAcceptedKeyTypes +ssh-rsa*
  ServerAliveInterval 60
  TCPKeepAlive yes

Host a?-* a??-* hpc-* hpc2020-* ecs-*
  ProxyJump jump.ecmwf.int
</pre></div>
</div>
<p><em>note: may need to append ``Host ecs-login hpc-login`` below last line</em>
5. run <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">hpc-login</span></code> 6. once you’re logged in, run <code class="docutils literal notranslate"><span class="pre">ssh-key-setup</span></code></p>
</section>
<section id="now-that-youre-in-set-up-your-account-for-success">
<h3>Now that you’re in, set up your account for success<a class="headerlink" href="#now-that-youre-in-set-up-your-account-for-success" title="Link to this heading">¶</a></h3>
<ol class="arabic simple">
<li><p>Copy and source bash profile from user <code class="docutils literal notranslate"><span class="pre">rukv</span></code> <em>note: an example
bashrc profile will be uploaded to github soon..</em></p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>cd $HOME
cd ../rumb/
cp .bashrc $HOME/.bashrc
source .bashrc
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Transfer or clone FDM package.</p></li>
</ol>
<ul class="simple">
<li><p>Transfer can be done using rsync, see section below.</p></li>
<li><p>Cloning can bed one from github,
e.g. <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://github.com/brils001/IMAU-FDM</span></code>. May need to
set up Github SSH or personal token first.</p></li>
</ul>
</section>
</section>
<section id="compile-program-rundir-readpointlist-f90">
<h2>3. Compile <code class="docutils literal notranslate"><span class="pre">Program/Rundir/readpointlist.f90</span></code><a class="headerlink" href="#compile-program-rundir-readpointlist-f90" title="Link to this heading">¶</a></h2>
</section>
<section id="file-editing-transfer-and-version-control">
<h2>File editing, transfer, and version control<a class="headerlink" href="#file-editing-transfer-and-version-control" title="Link to this heading">¶</a></h2>
<section id="using-rsync-to-transfer-files">
<h3>Using rsync to transfer files<a class="headerlink" href="#using-rsync-to-transfer-files" title="Link to this heading">¶</a></h3>
<p><code class="docutils literal notranslate"><span class="pre">rsync</span> <span class="pre">-avz</span> <span class="pre">mydataset</span> <span class="pre">hpc-login:PATH</span></code>
e.g. <code class="docutils literal notranslate"><span class="pre">rsync</span> <span class="pre">-avz</span> <span class="pre">testfile.txt</span> <span class="pre">hpc-login:/ec/res4/scratch/USERNAME</span></code>;
replace USERNAME with your own</p>
<p><em>note:</em> the file paths in the
<a class="reference external" href="https://confluence.ecmwf.int/display/UDOC/HPC2020%3A+File+transfers">tutorial</a>
are wrong, use the paths that show up when you login into the node:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>[ECMWF-INFO -ecprofile] $SCRATCH=/ec/res4/scratch/USERNAME
[ECMWF-INFO -ecprofile] $PERM=/perm/USERNAME
[ECMWF-INFO -ecprofile] $HPCPERM=/ec/res4/hpcperm/USERNAME
</pre></div>
</div>
</section>
<section id="github-ssh-personal-token-for-cloning">
<h3>Github SSH/personal token for cloning<a class="headerlink" href="#github-ssh-personal-token-for-cloning" title="Link to this heading">¶</a></h3>
<section id="personal-token">
<h4>Personal token<a class="headerlink" href="#personal-token" title="Link to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>To create a new personal access token, go to www.githhub.com, then
<em>account</em> → <em>developer settings</em> → <em>new personal token</em>. Classic
token is fine.</p></li>
<li><p>Copy and save the token somewhere.</p></li>
<li><p>Any repo can now be cloned using the token:
<code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">clone</span> <span class="pre">https://TOKEN&#64;github.com/USERNAME/REPOSITORY.git</span></code></p></li>
</ol>
</section>
<section id="ssh-1">
<span id="id1"></span><h4>SSH<a class="headerlink" href="#ssh-1" title="Link to this heading">¶</a></h4>
<p><em>coming soon</em></p>
</section>
</section>
<section id="using-rmate-to-edit-files-in-dekstop-sublime">
<h3>Using rmate to edit files in dekstop sublime<a class="headerlink" href="#using-rmate-to-edit-files-in-dekstop-sublime" title="Link to this heading">¶</a></h3>
<p><em>Instructions to open a tunnel between the HPC and your desktop version
of Sublime (a text editor). Some people find this much easier to use
than vim.</em> 1. Install <a class="reference external" href="https://www.sublimetext.com/">sublime</a> 2. In
Sublime, install rsub using <a class="reference external" href="https://packagecontrol.io/installation">the package
manager</a>: cmd/ctrl+shift+p -&gt;
type <code class="docutils literal notranslate"><span class="pre">Package</span> <span class="pre">Control:</span> <span class="pre">Install</span> <span class="pre">Package</span></code> -&gt; type <code class="docutils literal notranslate"><span class="pre">rsub</span></code> and hit enter
3. Restart Sublime 4. In your terminal, open <code class="docutils literal notranslate"><span class="pre">.ssh/config</span></code> and add
<code class="docutils literal notranslate"><span class="pre">RemoteForward</span> <span class="pre">52698</span> <span class="pre">127.0.0.1:52698</span></code>
under<code class="docutils literal notranslate"><span class="pre">Host</span> <span class="pre">jump.ecmwf.int</span> <span class="pre">a?-*</span> <span class="pre">a??-*</span> <span class="pre">hpc-*</span> <span class="pre">hpc2020-*</span> <span class="pre">ecs-*</span></code>. 5. SSH
into ECMWF 6. Run the following to download <code class="docutils literal notranslate"><span class="pre">rmate</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">Lo</span> <span class="o">~/</span><span class="nb">bin</span><span class="o">/</span><span class="n">rmate</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">textmate</span><span class="o">/</span><span class="n">rmate</span><span class="o">/</span><span class="n">master</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">rmate</span>
<span class="n">chmod</span> <span class="n">a</span><span class="o">+</span><span class="n">x</span> <span class="o">~/</span><span class="nb">bin</span><span class="o">/</span><span class="n">rmate</span>
</pre></div>
</div>
<ol class="arabic simple" start="7">
<li><p>Add <code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">a+x</span> <span class="pre">~/bin/rmate</span></code> and <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">PATH=&quot;$PATH:$HOME/bin&quot;</span></code>
to your <code class="docutils literal notranslate"><span class="pre">bashrc</span></code></p></li>
<li><p>Now you can type <code class="docutils literal notranslate"><span class="pre">rmate</span> <span class="pre">FILENAME</span></code> and edit the file in Sublime on
your system.</p></li>
</ol>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">IMAU-FDM</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="filestructure.html">File Structure</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Setting up ECMWF to run the IMAU Firn Densification Model</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#resources">Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#pre-requisites">Pre-requisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="#logging-in-for-the-first-time">Logging in for the first time</a></li>
<li class="toctree-l2"><a class="reference internal" href="#compile-program-rundir-readpointlist-f90">3. Compile <code class="docutils literal notranslate"><span class="pre">Program/Rundir/readpointlist.f90</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#file-editing-transfer-and-version-control">File editing, transfer, and version control</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="filestructure.html" title="previous chapter">File Structure</a></li>
      <li>Next: <a href="preprocessing.html" title="next chapter">&lt;no title&gt;</a></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;MIT License.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.2.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
      |
      <a href="_sources/ECMWF_access.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>